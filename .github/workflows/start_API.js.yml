name: start_API
on:
  push:
    branches: [feature_git_actions_test]
jobs:
  #     Explore-GitHub-Actions:
  #       runs-on: ubuntu-latest
  #       steps:
  #        - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
  #        - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
  #        - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
  #        - name: Check out repository code
  #          uses: actions/checkout@v2
  #        - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
  #        - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."
  #        - name: List files in the repository
  #          run: |
  #                 ls ${{ github.workspace }}
  #        - run: echo "ğŸ This job's status is ${{ job.status }}."
  upApi:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout api
        uses: actions/checkout@v2
        with:
          repository: xx3u/amal_backend
          ref: develop
      - name: Start containers
        run: docker-compose -f "docker-compose.yml" up -d --build
      - name: Run test
        run: |
        docker exec amal_frontend_backend_1 bash 
        npm run migrate
        npm run seed
        npm run test
        

  upFront:
    needs: upApi

    runs-on: ubuntu-latest
    steps:
      - name: Checkout frontEnd
        uses: actions/checkout@v2
      - name: Install dependencies
        run: npm ci
      - name: start app
        run: npm start&

  runTest:
    needs: [upApi, upFront]

    runs-on: ubuntu-latest
    steps:
      - name: Checkout test
        uses: actions/checkout@v2
        with:
          repository: BauyrjanSeidahmet/amal_tests
          ref: test_login
      - name: Install Chrome
        uses: browser-actions/setup-chrome@latest
      - name: check Chrome
        run: chrome --version

      - name: Install dependencies
        run: npm ci
      - name: run test
        run: npm start
